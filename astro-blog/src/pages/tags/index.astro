---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

// Get all posts and extract unique tags
const allPosts = await getCollection("posts");

// Count posts per tag
const tagCounts = new Map<string, number>();
allPosts.forEach((post) => {
  if (post.data.tags) {
    post.data.tags.forEach((tag) => {
      tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
    });
  }
});

// Sort tags alphabetically
const sortedTags = Array.from(tagCounts.entries()).sort((a, b) =>
  a[0].localeCompare(b[0])
);
---

<BaseLayout
  title="All Tags - Engineering Leadership Blog"
  description="Browse all topics on the engineering leadership blog"
>
  <div class="tags-page">
    <header class="tags-header">
      <h1>All Tags</h1>
      <p class="subtitle">Browse posts by topic</p>
    </header>

    <div class="tags-container">
      {
        sortedTags.map(([tag, count]) => (
          <a href={`/tags/${tag}/`} class="tag-card">
            <span class="tag-name">{tag}</span>
            <span class="tag-count">{count} post{count !== 1 ? "s" : ""}</span>
          </a>
        ))
      }
    </div>
  </div>
</BaseLayout>

<style>
  .tags-page {
    max-width: 800px;
    margin: 0 auto;
  }

  .tags-header {
    margin-bottom: var(--space-l);
    text-align: center;
  }

  .tags-header h1 {
    font-size: var(--heading-size-h1);
    line-height: var(--heading-line-height-h1);
    color: var(--text-color-primary);
    margin-bottom: var(--space-s);
  }

  .subtitle {
    font-size: var(--font-size-m);
    color: var(--color-neutral-gray-j);
  }

  .tags-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: var(--space-m);
  }

  .tag-card {
    display: flex;
    flex-direction: column;
    padding: var(--space-m);
    border-radius: var(--size-radius-default);
    background: var(--color-neutral-white);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    text-decoration: none;
    transition: all var(--time-duration-default);
  }

  .tag-card:hover {
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.15);
    transform: translateY(-2px);
  }

  .tag-name {
    font-size: var(--font-size-m);
    font-weight: var(--font-weight-bold);
    color: var(--color-brand-primary);
    margin-bottom: var(--space-xs);
  }

  .tag-count {
    font-size: var(--font-size-s);
    color: var(--color-neutral-gray-h);
  }

  @media (max-width: 599px) {
    .tags-container {
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: var(--space-s);
    }
  }
</style>
